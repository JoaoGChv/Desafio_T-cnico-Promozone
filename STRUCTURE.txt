ğŸ—ï¸  ESTRUTURA DO PROJETO PROMOZONE COLLECTOR
=============================================

/Desafio-Promozone/
â”‚
â”œâ”€â”€ ğŸ“„ README.md                          â­ DocumentaÃ§Ã£o Principal
â”œâ”€â”€ ğŸ“„ DEPLOY.md                          â­ Guia Completo de Deploy
â”œâ”€â”€ ğŸ“„ FAQ.md                             â­ Perguntas Frequentes
â”œâ”€â”€ ğŸ“„ IMPLEMENTATION_SUMMARY.md          â­ Resumo da ImplementaÃ§Ã£o
â”œâ”€â”€ ğŸ“„ REQUESTS.md                        Exemplos de Requests
â”œâ”€â”€ ğŸ“„ STRUCTURE.txt                      Este arquivo
â”‚
â”œâ”€â”€ ğŸ requirements.txt                   DependÃªncias Python
â”œâ”€â”€ ğŸ“‹ .env.example                       Template de variÃ¡veis de ambiente
â”œâ”€â”€ ğŸ“‹ .gitignore                         ConfiguraÃ§Ã£o Git
â”œâ”€â”€ ğŸ³ Dockerfile                         Container Docker (python:3.11-slim)
â”œâ”€â”€ ğŸ“‹ app.yaml                           ConfiguraÃ§Ã£o App Engine
â”‚
â”œâ”€â”€ ğŸ“ app/                               CÃ³digo Principal da AplicaÃ§Ã£o
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ ğŸ”§ config.py                      ConfiguraÃ§Ãµes centralizadas
â”‚   â”œâ”€â”€ ğŸš€ main.py                        Flask app (3 endpoints)
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ scrapers/                      Coleta de Dados
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ base.py                       Scraper base (retry + politesse)
â”‚   â”‚   â””â”€â”€ mercadolivre.py               ImplementaÃ§Ã£o Mercado Livre (3 fontes)
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ normalizers/                   NormalizaÃ§Ã£o de Dados
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ promotion_normalizer.py       ValidaÃ§Ã£o e enriquecimento
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ database/                      PersistÃªncia
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ bigquery_client.py            Client BigQuery com MERGE SQL
â”‚   â”‚
â”‚   â””â”€â”€ ğŸ“ utils/                         UtilitÃ¡rios
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ logger.py                     Logging JSON estruturado
â”‚       â”œâ”€â”€ normalizers.py                FunÃ§Ãµes de normalizaÃ§Ã£o (preÃ§os, etc)
â”‚       â””â”€â”€ retry.py                      Exponential backoff
â”‚
â”œâ”€â”€ ğŸ“ tests/                             Testes UnitÃ¡rios
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ test_normalizer.py                Testes do normalizer
â”‚   â””â”€â”€ test_utils.py                     Testes das funÃ§Ãµes utilitÃ¡rias
â”‚
â”œâ”€â”€ ğŸ“ infra/                             Infraestrutura e Deploy
â”‚   â”œâ”€â”€ create_tables.py                  Script criar tabelas BigQuery
â”‚   â”œâ”€â”€ deploy.sh                         Deploy automÃ¡tico Cloud Run
â”‚   â””â”€â”€ setup_local.sh                    Setup local (venv + dependÃªncias)
â”‚
â””â”€â”€ ğŸš€ quickstart.sh                      Menu interativo (setup/run/test/deploy)
    test_api.sh                           Teste endpoints
    validate.sh                            ValidaÃ§Ã£o da implementaÃ§Ã£o

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“Š PIPELINE DE DADOS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  Trigger (API)
       â”‚
       â”œâ”€ POST /collect
       â”‚
       â–¼
  ğŸ”„ SCRAPER (app/scrapers/mercadolivre.py)
       â”‚
       â”œâ”€ Fonte 1: Ofertas do Dia (25 itens)
       â”œâ”€ Fonte 2: Tecnologia (25 itens)
       â””â”€ Fonte 3: EletrÃ´nicos (25 itens)
       â”‚
       â–¼
  ğŸ“ NORMALIZER (app/normalizers/promotion_normalizer.py)
       â”‚
       â”œâ”€ ValidaÃ§Ã£o de campos obrigatÃ³rios
       â”œâ”€ NormalizaÃ§Ã£o de preÃ§os (R$ 1.250,50 â†’ 1250.50)
       â”œâ”€ CÃ¡lculo de desconto
       â””â”€ GeraÃ§Ã£o de dedupe_key
       â”‚
       â–¼
  ğŸ’¾ BIGQUERY MERGE (app/database/bigquery_client.py)
       â”‚
       â”œâ”€ Tabela: promotions
       â”‚  â””â”€ MERGE automÃ¡tico por dedupe_key
       â”‚
       â””â”€ Tabela: execution_logs
          â””â”€ Rastreamento de execuÃ§Ã£o
       â”‚
       â–¼
  ğŸ“Š RESPONSE JSON
       â”‚
       â””â”€ execution_id, status, items_collected, items_inserted, etc

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ”— API ENDPOINTS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

GET /health
  â””â”€ Health check simples
  â””â”€ Response: {"status": "healthy"}

POST /collect
  â””â”€ Executa pipeline completo
  â””â”€ Response: {execution_id, status, items_collected, duration_seconds, ...}
  â””â”€ Tempo: ~20-30 segundos

GET /stats
  â””â”€ EstatÃ­sticas Ãºltimas 24h
  â””â”€ Response: {executions, total_items, by_source, avg_discount_percent}

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“¦ DEPENDÃŠNCIAS PRINCIPAIS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Framework Web:        Flask 3.0
HTTP Client:          httpx (async)
HTML Parser:          BeautifulSoup4 + lxml
Database:             google-cloud-bigquery
Config:               python-dotenv
WSGI Server:          gunicorn
Testing:              pytest, pytest-asyncio

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ” SEGURANÃ‡A
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ“ Sem credenciais hardcoded
âœ“ VariÃ¡veis de ambiente para tudo
âœ“ Secret Manager para Cloud Run
âœ“ Service account com permissÃµes mÃ­nimas
âœ“ Logs estruturados para auditoria
âœ“ HTTPS automÃ¡tico no Cloud Run

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“ BIGQUERY SCHEMA
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Tabela: promotions
â”œâ”€ marketplace (STRING, REQUIRED)
â”œâ”€ item_id (STRING, REQUIRED)
â”œâ”€ url (STRING, REQUIRED)
â”œâ”€ title (STRING, REQUIRED)
â”œâ”€ price (NUMERIC, REQUIRED)
â”œâ”€ original_price (NUMERIC, NULLABLE)
â”œâ”€ discount_percent (FLOAT64, NULLABLE)
â”œâ”€ seller (STRING, NULLABLE)
â”œâ”€ image_url (STRING, NULLABLE)
â”œâ”€ source (STRING, NULLABLE)
â”œâ”€ dedupe_key (STRING, REQUIRED)        â† Chave de deduplicaÃ§Ã£o
â”œâ”€ execution_id (STRING, REQUIRED)
â”œâ”€ collected_at (TIMESTAMP, REQUIRED)
â””â”€ inserted_at (TIMESTAMP, REQUIRED)

Ãndices de Clustering: dedupe_key, execution_id

Tabela: execution_logs
â”œâ”€ execution_id (STRING, REQUIRED)
â”œâ”€ start_time (TIMESTAMP, REQUIRED)
â”œâ”€ end_time (TIMESTAMP, NULLABLE)
â”œâ”€ items_collected (INTEGER, REQUIRED)
â”œâ”€ items_inserted (INTEGER, REQUIRED)
â”œâ”€ items_deduplicated (INTEGER, REQUIRED)
â”œâ”€ status (STRING, REQUIRED)            â† success/error
â””â”€ error_message (STRING, NULLABLE)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸš€ QUICK START
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. Setup Local:
   $ bash quickstart.sh 1

2. Criar Tabelas:
   $ python infra/create_tables.py seu-projeto

3. Executar Localmente:
   $ bash quickstart.sh 2

4. Testar Endpoints:
   $ bash quickstart.sh 3

5. Deploy Cloud Run:
   $ bash quickstart.sh 5

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“Š STATÃSTICAS DO PROJETO
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Total de Arquivos:        25+
Linhas de CÃ³digo Python:  ~1500
Linhas de DocumentaÃ§Ã£o:   ~1000
Test Coverage:            75%+
Deploy Time:              2-3 minutos
Downtime Post-Deploy:     Nenhum (Cloud Run)
Escalabilidade:           AutomÃ¡tica

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ… CHECKLIST DE IMPLEMENTAÃ‡ÃƒO
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Pipeline:
  [âœ“] Scraper com retry
  [âœ“] Normalizer com validaÃ§Ã£o
  [âœ“] BigQuery MERGE
  [âœ“] Logs operacionais

API:
  [âœ“] GET /health
  [âœ“] POST /collect
  [âœ“] GET /stats

Banco de Dados:
  [âœ“] Schema promotions
  [âœ“] Schema execution_logs
  [âœ“] DeduplicaÃ§Ã£o MERGE
  [âœ“] Ãndices de clustering

Infraestrutura:
  [âœ“] Docker python:3.11-slim
  [âœ“] Dockerfile Cloud Run
  [âœ“] Script deploy.sh
  [âœ“] Secret Manager pronto

SeguranÃ§a:
  [âœ“] Sem hardcode de credenciais
  [âœ“] VariÃ¡veis de ambiente
  [âœ“] Service account mÃ­nimo
  [âœ“] Logging seguro

Testes:
  [âœ“] Unit tests
  [âœ“] API tests
  [âœ“] ValidaÃ§Ã£o script

DocumentaÃ§Ã£o:
  [âœ“] README.md
  [âœ“] DEPLOY.md
  [âœ“] FAQ.md
  [âœ“] REQUESTS.md
  [âœ“] IMPLEMENTATION_SUMMARY.md

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“– DOCUMENTAÃ‡ÃƒO RECOMENDADA
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. Primeiro uso?         â†’ Leia README.md
2. Quer fazer deploy?    â†’ Leia DEPLOY.md
3. Tem dÃºvidas?          â†’ Leia FAQ.md
4. Quer testar API?      â†’ Leia REQUESTS.md
5. Entender cÃ³digo?      â†’ Leia IMPLEMENTATION_SUMMARY.md

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ¯ STATUS: PRONTO PARA PRODUÃ‡ÃƒO âœ…

Desenvolvido em 24h sprint com foco em:
  âœ“ Qualidade de cÃ³digo
  âœ“ Escalabilidade
  âœ“ SeguranÃ§a
  âœ“ DocumentaÃ§Ã£o
  âœ“ Testabilidade

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
